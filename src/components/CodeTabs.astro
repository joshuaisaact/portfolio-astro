---
import { Code } from 'astro:components';

interface Tab {
  label: string;
  lang: string;
  code: string;
}

interface Props {
  tabs: Tab[];
}

const { tabs } = Astro.props;

const languageLogos: Record<string, string> = {
  typescript: '/logos/typescript.svg',
  ts: '/logos/typescript.svg',
  zig: '/logos/zig.svg',
  go: '/logos/gopher.svg',
  golang: '/logos/gopher.svg',
  python: '/logos/python.svg',
  py: '/logos/python.svg',
};

function getLogoPath(tab: Tab): string | null {
  const langLower = tab.lang.toLowerCase();
  const labelLower = tab.label.toLowerCase();
  return languageLogos[langLower] || languageLogos[labelLower] || null;
}
---

<div class="code-tabs my-6">
  <div class="flex gap-2 bg-[rgb(36,41,51)] rounded-t-lg px-2">
    {tabs.map((tab, i) => (
      <button
        class={`tab-btn flex items-center gap-1.5 px-4 text-sm font-medium text-gray-400 bg-transparent border-none border-b-2 border-transparent cursor-pointer transition-all -mb-px hover:text-gray-200 ${i === 0 ? 'active' : ''}`}
        data-tab={i}
        type="button"
      >
        {getLogoPath(tab) && (
          <img src={getLogoPath(tab)} alt="" class="block w-4 h-4 shrink-0" />
        )}
        {tab.label}
      </button>
    ))}
  </div>
  <div>
    {tabs.map((tab, i) => (
      <div class={`tab-panel ${i === 0 ? '' : 'hidden'}`} data-panel={i}>
        <Code code={tab.code} lang={tab.lang} theme="github-dark" />
      </div>
    ))}
  </div>
</div>

<script>
  function initCodeTabs() {
    document.querySelectorAll('.code-tabs').forEach(container => {
      const buttons = container.querySelectorAll('.tab-btn');
      const panels = container.querySelectorAll('.tab-panel');

      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          const tabIndex = btn.getAttribute('data-tab');

          // Update buttons
          buttons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');

          // Update panels
          panels.forEach(p => p.classList.add('hidden'));
          container.querySelector(`[data-panel="${tabIndex}"]`)?.classList.remove('hidden');
        });
      });
    });
  }

  initCodeTabs();
  document.addEventListener('astro:page-load', initCodeTabs);
</script>

<style>
  .tab-btn.active {
    color: rgb(96 165 250);
    border-bottom-color: rgb(96 165 250);
  }

  .tab-panel :global(pre) {
    margin-top: 0 !important;
    border-top-left-radius: 0;
    border-top-right-radius: 0;
  }
</style>
