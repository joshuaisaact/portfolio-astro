---
import BlogCarousel from "../components/BlogCarousel.astro";
import Contact from "../components/Contact.astro";
import Navbar from "../components/Navbar.astro";
import Projects from "../components/Projects.astro";
import ProjectCarousel from "../components/ProjectCarousel.astro";
import Section from "../components/Section.astro";
import Welcome from "../components/Welcome.astro";
import Layout from "../layouts/Layout.astro";
import { ArrowRight } from "lucide-astro";
import { getCollection } from "astro:content";

const allProjects = await getCollection("projects");

const applicationProjects = allProjects
  .filter((p) => !p.data.projectType || p.data.projectType === "application")
  .sort((a, b) => (a.data.order ?? 999) - (b.data.order ?? 999))
  .map((p) => p.data);

const utilityProjects = allProjects
  .filter((p) =>
    ["tool", "library", "starter"].includes(p.data.projectType || ""),
  )
  .sort((a, b) => (a.data.order ?? 999) - (b.data.order ?? 999))
  .map((p) => p.data);

const allPosts = await getCollection("blog");
const blogPosts = allPosts.sort(
  (a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime(),
);
---

<a
  href="#main-content"
  class="sr-only focus:not-sr-only focus:absolute focus:z-50 focus:p-4 focus:bg-white dark:focus:bg-gray-900 focus:text-blue-600"
>
  Skip to main content
</a>

<Layout>
  <Navbar />
  <main
    id="main-content"
    class="mx-auto max-w-7xl px-2 sm:px-4 lg:px-8"
    role="main"
  >
    <Welcome />
    <Section id="projects" title="Featured Projects">
      <ProjectCarousel projects={applicationProjects} />
      <div class="mt-6 text-center">
        <a
          href="/projects"
          class="inline-flex items-center gap-2 text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium transition-colors"
        >
          <span>View all projects</span>
          <ArrowRight class="w-4 h-4" />
        </a>
      </div>
    </Section>
    <Section id="dev-tools" title="Developer Tools & Utilities" cardType="full">
      <Projects
        projects={utilityProjects}
        projectType="tool"
        cardType="minimal"
      />
    </Section>
    <Section id="blog" title="Blog">
      <BlogCarousel posts={blogPosts} />
      <div class="mt-6 text-center">
        <a
          href="/blog"
          class="inline-flex items-center gap-2 text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium transition-colors"
        >
          <span>View all posts</span>
          <ArrowRight class="w-4 h-4" />
        </a>
      </div>
    </Section>
    <Section id="contact" title="Contact">
      <Contact />
    </Section>
  </main>
</Layout>
